pkgname=vesktop
version=1.6.4
revision=1
archs="x86_64"
short_desc="Custom Discord desktop client"
maintainer="Wizzard <rich@bandaholics.cash>"
license="GPL-3.0-or-later"
homepage="https://github.com/Vencord/Vesktop"
distfiles="https://github.com/Vencord/Vesktop/releases/download/v${version}/vesktop_${version}_amd64.deb"
checksum=8e5c5ba0aacb83a6e9514bf63c17df7a1c16b01e150b6bd20441e6a127fbe845
hostmakedepends="binutils tar xz"
depends="gtk+3 libnotify nss libXScrnSaver libXtst xdg-utils at-spi2-core util-linux-libs libsecret"

do_extract() {
	ar x ${XBPS_SRCDISTDIR}/${pkgname}-${version}/vesktop_${version}_amd64.deb
	mkdir -p ${wrksrc}
	tar xf data.tar.xz -C ${wrksrc}
}

do_install() {
	vmkdir usr/share/applications
	vmkdir usr/share/icons
	vmkdir usr/share/doc/vesktop
	vmkdir opt/Vesktop
	vcopy usr/share/applications/vesktop.desktop /usr/share/applications/
	vcopy usr/share/icons /usr/share/
	vcopy usr/share/doc/vesktop/* /usr/share/doc/vesktop/
	vcopy opt/Vesktop/* /opt/Vesktop/
	if [ -f ${DESTDIR}/opt/Vesktop/chrome-sandbox ]; then
		chmod 4755 ${DESTDIR}/opt/Vesktop/chrome-sandbox
	fi
	vmkdir usr/bin
	ln -sf /opt/Vesktop/vesktop ${DESTDIR}/usr/bin/vesktop
	vlicense opt/Vesktop/LICENSE.electron.txt
	vlicense opt/Vesktop/LICENSES.chromium.html
}